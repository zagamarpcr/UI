<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>3D Terrain with Physics and Character</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    #game-container {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #canvas {
      border: 1px solid red;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <canvas id="canvas" width="640" height="480"></canvas>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/FirstPersonControls.js"></script>
  <script>
    let canvas = document.getElementById("canvas");
    if (!canvas) {
      console.error("Failed to get canvas element");
    }
    let ctx = canvas.getContext("webgl");
    if (!ctx) {
      console.error("Failed to create WebGL context");
    }
    let scene = new THREE.Scene();
    let camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 1000);
    let renderer = new THREE.WebGLRenderer({
      canvas: canvas,
      antialias: true
    });

    let controls = new THREE.FirstPersonControls(camera, canvas);
    if (!controls) {
      console.error("Failed to create FirstPersonControls");
    }
    controls.lookSpeed = 0.1;
    controls.movementSpeed = 5;
    controls.noFly = true;

    document.addEventListener("keydown", (event) => {
      switch (event.key) {
        case "w":
          camera.position.z -= 5;
          break;
        case "s":
          camera.position.z += 5;
          break;
        case "a":
          camera.position.x -= 5;
          break;
        case "d":
          camera.position.x += 5;
          break;
      }
    });

    document.addEventListener("mousemove", (event) => {
      controls.lookAt(event.clientX, event.clientY);
    });

    // Add some basic lighting
    let ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);

    let pointLight = new THREE.PointLight(0xffffff, 1, 100);
    pointLight.position.set(5, 5, 5);
    scene.add(pointLight);

    // Add a plane to the scene
    let planeGeometry = new THREE.PlaneGeometry(100, 100);
    let planeMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
    let plane = new THREE.Mesh(planeGeometry, planeMaterial);
    plane.rotation.x = -Math.PI / 2;
    scene.add(plane);

    // Render the scene
    function animate() {
      requestAnimationFrame(animate);
      controls.update(0.01);
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>